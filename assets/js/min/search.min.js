var elSearchBox=document.querySelector(".search"),elSearchBtn=document.querySelector(".search-start"),elSearchClear=document.querySelector(".search-clear"),elSearchInput=document.querySelector(".search-input"),elSearchResults=document.querySelector(".search-results"),searchValue="",arrItems=[],arrContents=[],arrLinks=[],arrTitles=[],arrResults=[],indexItem=[],itemLength=0,tmpDiv=document.createElement("div"),tmpAnchor=document.createElement("a"),xhr=new XMLHttpRequest||new ActiveXObject("Microsoft.XMLHTTP");function searchConfirm(){if(""==elSearchInput.value)searchClear();else if(elSearchInput.value.search(/^\s+$/)>=0){searchInit();var e=tmpDiv.cloneNode(!0);e.innerText="请输入有效内容...",elSearchResults.appendChild(e)}else searchInit(),searchValue=elSearchInput.value,searchMatching(arrTitles,arrContents,searchValue)}function searchClear(){elSearchInput.value="",elSearchClear.style.display="none",elSearchResults.style.display="none",elSearchResults.classList.remove("result-item")}function searchInit(){arrResults=[],indexItem=[],elSearchResults.innerHTML="",elSearchClear.style.display="block",elSearchResults.style.display="block",elSearchResults.classList.add("result-item")}function searchMatching(e,t,r){var a=new RegExp(r,"i");for(i=0;i<itemLength;i++){var l,s,n=e[i].search(a),c=t[i].search(a);if(-1!==n||-1!==c){-1!==n?(l=n,s=e):(l=c,s=t),indexItem.push(i);var h=s[i].match(a)[0].length;arrResults.push(s[i].slice(l-10,l)+"<mark>"+s[i].slice(l,l+h)+"</mark>"+s[i].slice(l+h,l+h+10))}}var o=tmpDiv.cloneNode(!0);(o.className="result-title",o.innerHTML="总匹配：<b>"+indexItem.length+"</b> 项",elSearchResults.appendChild(o),0==indexItem.length)&&((d=tmpDiv.cloneNode(!0)).innerText="未匹配到内容...",d.className="teal-text text-darken-3 result-item",elSearchResults.appendChild(d));for(i=0;i<arrResults.length;i++){var d=tmpDiv.cloneNode(!0),m=tmpDiv.cloneNode(!0),u=tmpDiv.cloneNode(!0),p=tmpAnchor.cloneNode(!0);d.className="card hoverable result-item",m.className="card-content result-item-title",u.className="card-action result-item-detail",p.className="blue-text",m.innerText=e[indexItem[i]],p.innerHTML=arrResults[i],p.href=arrLinks[indexItem[i]],d.appendChild(m),u.appendChild(p),d.appendChild(u),elSearchResults.appendChild(d)}}xhr.onreadystatechange=function(){if(4==xhr.readyState&&200==xhr.status){var e=xhr.responseXML;for(arrItems=e.getElementsByTagName("item"),itemLength=arrItems.length,i=0;i<itemLength;i++)arrContents[i]=arrItems[i].getElementsByTagName("description")[0].childNodes[0].nodeValue.replace(/<.*?>/g,""),arrLinks[i]=arrItems[i].getElementsByTagName("link")[0].childNodes[0].nodeValue.replace(/<.*?>/g,""),arrTitles[i]=arrItems[i].getElementsByTagName("title")[0].childNodes[0].nodeValue.replace(/<.*?>/g,"");elSearchBox.style.display="block"}},xhr.open("get","/feed.xml",!0),xhr.send(),elSearchBtn.onclick=searchConfirm,elSearchClear.onclick=searchClear,elSearchInput.oninput=function(){setTimeout(searchConfirm,0)},window.addEventListener("load",searchClear);